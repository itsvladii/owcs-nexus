---
const { transfer } = Astro.props;
import '../../styles/global.css';

// 1. Detect Type & Theme
const isJoin = transfer.from === "Free Agent" || transfer.from === "";
const isLeave = transfer.to === "Free Agent" || transfer.to === "";
const isTrade = !isJoin && !isLeave;

let theme = {
    color: "text-amber-400",
    border: "border-amber-500",
    glow: "shadow-[0_0_15px_-5px_rgba(245,158,11,0.3)]",
    bg: "bg-amber-500/5",
    icon: "⇄",
    label: "TRADE"
};

if (isJoin) {
    theme = {
        color: "text-emerald-400",
        border: "border-emerald-500",
        glow: "shadow-[0_0_15px_-5px_rgba(16,185,129,0.3)]",
        bg: "bg-emerald-500/5",
        icon: "↘",
        label: "SIGNING"
    };
} else if (isLeave) {
    theme = {
        color: "text-rose-500",
        border: "border-rose-500",
        glow: "shadow-[0_0_15px_-5px_rgba(244,63,94,0.3)]",
        bg: "bg-rose-500/5",
        icon: "↗",
        label: "RELEASE"
    };
}

// 2. Handle Players
const playerList = transfer.players || [{ name: transfer.player, role: transfer.role }];
---

<div class={`group relative w-full bg-neutral-900/80 backdrop-blur-sm border border-white/5 rounded-none border-l-2 ${theme.border} p-5 hover:bg-white/[0.02] transition-all`}>
    
    {/* Hover Glow Effect */}
    <div class={`absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none ${theme.bg}`}></div>

    <div class="relative flex flex-col md:flex-row gap-6 items-center">

        {/* LEFT: DATE & LABEL */}
        <div class="flex md:flex-col items-center md:items-start gap-3 md:gap-1 md:w-32 shrink-0 border-b md:border-b-0 md:border-r border-white/5 pb-3 md:pb-0 md:pr-4 w-full">
            <div class="flex flex-col">
                 <span class="text-[10px] font-mono text-neutral-500 uppercase tracking-wider">
                    {new Date(transfer.date).toLocaleString('default', { month: 'short' })} {new Date(transfer.date).getDate()}
                 </span>
                 <span class={`text-xs font-black uppercase tracking-widest ${theme.color}`}>
                    {theme.label}
                 </span>
            </div>
        </div>

        {/* MIDDLE: PLAYERS */}
        <div class="flex-1 w-full space-y-2">
            {playerList.map((p) => {
                const isCoach = p.role.toLowerCase().includes('coach');
                return (
                    <div class="flex items-center justify-between md:justify-start gap-4">
                        <span class="text-xl md:text-2xl font-black text-white uppercase tracking-tight font-title leading-none">
                            {p.name}
                        </span>
                        <span class={`text-[9px] font-bold uppercase px-2 py-0.5 rounded border ${isCoach ? 'border-cyan-500/20 text-cyan-400 bg-cyan-500/10' : 'border-neutral-700 text-neutral-500 bg-neutral-800/50'}`}>
                            {p.role || "Player"}
                        </span>
                    </div>
                );
            })}
        </div>

        {/* RIGHT: MOVEMENT VISUAL */}
        <div class="flex items-center gap-4 justify-between md:justify-end w-full md:w-auto pt-3 md:pt-0 border-t md:border-t-0 border-white/5">
            
            {/* FROM */}
            <div class="text-right">
                <span class="block text-[10px] text-neutral-500 font-mono uppercase mb-0.5">From</span>
                <span class={`block text-sm font-bold uppercase truncate max-w-[120px] ${!transfer.from || transfer.from === "Free Agent" ? 'text-neutral-600' : 'text-white'}`}>
                    {transfer.from || "FA"}
                </span>
            </div>

            {/* ARROW */}
            <div class={`w-8 h-8 rounded-full flex items-center justify-center bg-neutral-950 border border-white/10 ${theme.color} text-lg`}>
                {theme.icon}
            </div>

            {/* TO */}
            <div class="text-left">
                 <span class="block text-[10px] text-neutral-500 font-mono uppercase mb-0.5">To</span>
                <span class={`block text-sm font-bold uppercase truncate max-w-[120px] ${!transfer.to || transfer.to === "Free Agent" ? 'text-neutral-600' : 'text-white'}`}>
                    {transfer.to || "FA"}
                </span>
            </div>

        </div>

    </div>
</div>