---
const { transfer } = Astro.props;

// 1. Detect Type
const isJoin = transfer.from === "Free Agent" || transfer.from === "";
const isLeave = transfer.to === "Free Agent" || transfer.to === "";

// 2. Theme Logic
let theme = { border: "border-neutral-800", bg: "bg-neutral-900", icon: "text-neutral-500", label: "TRANSFER" };

if (isJoin) {
    theme = { border: "border-green-500/30", bg: "bg-green-950/10", icon: "text-green-500", label: "ACQUISITION" };
} else if (isLeave) {
    theme = { border: "border-red-500/30", bg: "bg-red-950/10", icon: "text-red-500", label: "DEPARTURE" };
} else {
    theme = { border: "border-amber-500/30", bg: "bg-amber-950/10", icon: "text-amber-500", label: "TRADE" };
}

// 3. Handle Single vs Group
// If 'players' array exists, use it. If not, fallback to single 'player' prop (backward compatibility)
const playerList = transfer.players || [{ name: transfer.player, role: transfer.role }];
const isBatch = playerList.length > 1;
---

<div class={`relative w-full ${theme.bg} border ${theme.border} rounded-xl p-4 hover:border-opacity-100 transition-all group`}>
    
    <div class="flex flex-col md:flex-row gap-6">

        {/* LEFT: DATE & TYPE */}
        <div class="flex items-start gap-4 md:w-48 shrink-0">
             <div class="flex flex-col text-center w-12 shrink-0 pt-1">
                <span class="text-[10px] font-mono text-neutral-500">{new Date(transfer.date).toLocaleString('default', { month: 'short' })}</span>
                <span class="text-lg font-black text-white leading-none">{new Date(transfer.date).getDate()}</span>
            </div>
            
            <div class="w-px h-full min-h-[40px] bg-white/10 mx-2 hidden md:block"></div>
            
            <div class="flex flex-col pt-1">
                <span class={`text-[9px] font-black uppercase tracking-widest mb-1 ${theme.icon}`}>
                    {isBatch ? 'ROSTER UPDATE' : theme.label}
                </span>
                {/* Mobile-only date divider */}
                <div class="h-px w-8 bg-white/10 md:hidden my-2"></div>
            </div>
        </div>

        {/* MIDDLE: PLAYERS LIST */}
        <div class="flex-1 flex flex-col justify-center gap-2">
            {playerList.map((p) => {
                const isCoach = p.role.toLowerCase().includes('coach');
                return (
                    <div class="flex items-center gap-3">
                        <span class="text-xl font-title italic text-white uppercase leading-none">
                            {p.name}
                        </span>
                        <span class={`text-[9px] font-bold uppercase px-1.5 py-0.5 rounded border ${isCoach ? 'border-cyan-500/30 text-cyan-400 bg-cyan-500/10' : 'border-neutral-700 text-neutral-500 bg-neutral-800'}`}>
                            {p.role || "Player"}
                        </span>
                    </div>
                );
            })}
        </div>

        {/* RIGHT: MOVEMENT */}
        <div class="flex items-center gap-3 justify-end md:w-1/3 pt-2 md:pt-0 border-t md:border-t-0 border-white/5 mt-2 md:mt-0">
            
            {/* FROM */}
            <div class="text-right">
                <span class={`block text-xs font-black uppercase ${!transfer.from || transfer.from === "Free Agent" ? 'text-neutral-600' : 'text-white'}`}>
                    {transfer.from || "Free Agent"}
                </span>
            </div>

            {/* ARROW */}
            <svg xmlns="http://www.w3.org/2000/svg" class={`h-5 w-5 ${theme.icon} opacity-80`} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" /></svg>

            {/* TO */}
            <div class="text-left">
                <span class={`block text-xs font-black uppercase ${!transfer.to || transfer.to === "Free Agent" ? 'text-neutral-600' : 'text-white'}`}>
                    {transfer.to || "Free Agent"}
                </span>
            </div>

        </div>

    </div>
</div>