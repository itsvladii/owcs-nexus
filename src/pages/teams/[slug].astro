---
// src/pages/teams/[slug].astro
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection, getEntry } from 'astro:content';

// 1. Tell Astro to build a page for every team
export async function getStaticPaths() {
  const allTeams = await getCollection('teams');
  return allTeams.map(team => ({
    params: { slug: team.slug },
    props: { team },
  }));
}

// 2. Get this specific team's data
const { team } = Astro.props;

// 3. Find all players on this team (the "reverse lookup")
const allPlayers = await getCollection('players');
const roster = allPlayers.filter(player => player.data.team === team.slug);

// 4. Get the main content from the team's .md file
const { Content } = await team.render();

// 5. Get a big, nice logo URL
const logoUrl = team.data.logo
  ? team.data.logo.replace('/upload/', '/upload/w_256,h_256,c_pad,f_auto,q_auto/')
  : null;
---

<BaseLayout title={team.data.name}>
  <div class="max-w-4xl mx-auto">

    <div class="flex flex-col sm:flex-row items-center bg-gray-900 p-6 rounded-lg border border-gray-800">
      {logoUrl && (
        <img 
          src={logoUrl} 
          alt={`${team.data.name} Logo`}
          class="w-48 h-48 object-contain"
          width="256"
          height="256"
        />
      )}
      <div class="sm:ml-6 mt-4 sm:mt-0 text-center sm:text-left">
        <p class="text-xl text-gray-400">{team.data.region}</p>
        <h1 class="text-5xl font-bold text-white font-title">{team.data.name}</h1>
      </div>
    </div>

    <h2 class="text-3xl font-bold text-white font-title mt-8 mb-4">Active Roster</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
      {roster.map(player => (
        <a 
          href={`/players/${player.slug}/`} 
          class="bg-gray-800 rounded-lg p-4 text-center border border-gray-700 transition-transform duration-300 hover:scale-105"
        >
          <h3 class="text-2xl font-semibold text-white">{player.data.name}</h3>
          <p class="text-lg text-yellow-400">{player.data.role}</p>
        </a>
      ))}
    </div>

    <div class="prose prose-invert prose-lg max-w-none bg-gray-900 p-6 rounded-lg mt-6 border border-gray-800">
      <Content />
    </div>

  </div>
</BaseLayout>