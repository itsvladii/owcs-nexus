---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// 1. Get Data
const allTeams = (await getCollection('teams')).sort((a, b) => a.data.name.localeCompare(b.data.name));

// 2. Group by Region
const regionGroups = [
  { title: 'Korea', code: 'Korea', teams: [] },
  { title: 'North America', code: 'NA', teams: [] },
  { title: 'EMEA', code: 'EMEA', teams: [] },
  { title: 'China', code: 'China', teams: [] },
  { title: 'Asia Pacific', code: ['Pacific', 'Asia'], teams: [] },
  {title: 'Japan',code:'Japan',teams: []}
];

allTeams.forEach(team => {
  const region = team.data.region;
  const group = regionGroups.find(g => 
    Array.isArray(g.code) ? g.code.includes(region) : g.code === region
  );
  if (group) group.teams.push(team);
});

const HERO_BG = "https://live.staticflickr.com/65535/54698810054_71fc8a22c3_k.jpg";
---

<BaseLayout title="All Teams" fullWidth={true}>

  {/* HERO HEADER */}
  <div class="relative h-[40vh] md:h-[50vh] w-full overflow-hidden flex items-center justify-center rounded-xl">
     <img 
       src={HERO_BG} 
       alt="OWCS Teams" 
       class="absolute inset-0 w-full h-full object-cover object-center filter brightness-[0.3] blur-xs scale-105"
     />
     <div class="absolute inset-0 bg-gradient-to-b from-neutral-950/60 via-neutral-950/20 to-neutral-950"></div>
     
     <div class="relative z-10 text-center px-4">
        <h1 class="text-5xl md:text-7xl font-title text-white mb-4 drop-shadow-2xl">
          Featured Organizations
        </h1>
        <p class="text-lg md:text-xl text-neutral-400 max-w-2xl mx-auto">
          Browse the official partners and contenders defining the Overwatch Champions Series.
        </p>
     </div>
  </div>

  {/* TEAM DIRECTORY LIST */}
  <div class="max-w-5xl mx-auto px-4 pb-24 relative z-20 -mt-12 md:-mt-16">
    {regionGroups.map(group => {
      if (group.teams.length === 0) return null;

      return (
        <div class="mb-16">
          {/* Region Header */}
          <div class="flex items-end gap-4 mb-6 border-b border-neutral-800 pb-2">
             <h2 class="text-3xl md:text-4xl font-title text-white leading-none">{group.title}</h2>
             <span class="text-neutral-500 font-mono text-xs md:text-sm mb-1 px-2 py-0.5 bg-neutral-900 rounded border border-neutral-800">
               {group.teams.length} Teams
             </span>
          </div>

          {/* The List */}
          <div class="flex flex-col gap-3">
            {group.teams.map(team => {
              const color = team.data.colour || '#525252';
              const logo = team.data.logo.replace('/upload/', '/upload/w_200,c_fit,f_auto,q_auto/');
              
              // Use a HIGH RES version for the banner so it looks good when expanded
              const banner = team.data.banner 
                ? team.data.banner.replace('/upload/', '/upload/w_1200,h_600,c_fill,q_auto,f_auto/') 
                : HERO_BG;

              return (
                <a 
                  href={`/teams/${team.slug}/`} 
                  class="
                    group relative w-full 
                    h-24 md:h-28 /* Resting Height (Compact) */
                    rounded-xl overflow-hidden border border-neutral-800 bg-neutral-900
                    transition-all duration-500 ease-in-out
                    hover:border-neutral-600 hover:shadow-2xl hover:-translate-y-1
                    hover:h-56 /* EXPANDED Height (Cinematic) */
                  "
                  style={`--team-color: ${color};`}
                >
                  {/* 1. Background Banner (Reveals on Hover) */}
                  <div class="absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-500 delay-75">
                    <img 
                      src={banner} 
                      alt={team.data.name}
                      /* THE FIX: object-[center_30%] focuses on faces, not chests */
                      class="w-full h-full object-cover object-[center_30%] filter brightness-[0.4] grayscale group-hover:grayscale-0 transition-all duration-700" 
                    />
                    <div class="absolute inset-0 bg-gradient-to-r from-neutral-950 via-neutral-950/70 to-transparent"></div>
                  </div>
                  
                  {/* 2. Left Accent Bar */}
                  <div class="absolute left-0 top-0 bottom-0 w-1.5 transition-all duration-300 group-hover:w-3" style={`background-color: ${color}`}></div>

                  {/* 3. Content */}
                  <div class="relative z-10 h-full flex items-center px-6 md:px-8 justify-between">
                     
                     <div class="flex items-center gap-6 md:gap-8">
                        {/* Logo */}
                        <div class="w-14 h-14 md:w-16 md:h-16 shrink-0 rounded-lg p-2 flex items-center justify-center transition-all backdrop-blur-sm shadow-lg">
                           <img src={logo} alt={team.data.name} class="w-full h-full object-contain transition-transform duration-300" />
                        </div>
                        
                        {/* Name */}
                        <div class="flex flex-col justify-center">
                           <h3 class="text-3xl md:text-5xl font-title text-white leading-none group-hover:text-white transition-colors drop-shadow-lg">
                             {team.data.name}
                           </h3>
                           
                           {/* Partner Badge */}
                           {team.data.isPartner && (
                             <div class="flex items-center gap-2 mt-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 -translate-x-2 group-hover:translate-x-0">
                               <span 
                                 class="text-[10px] font-bold uppercase tracking-widest px-2 py-0.5 rounded text-black shadow-lg"
                                 style={`background-color: ${color};`}
                               >
                                 Partner
                               </span>
                             </div>
                           )}
                        </div>
                     </div>

                     {/* Right Arrow */}
                     <div class="hidden md:flex items-center gap-3 opacity-0 group-hover:opacity-100 transition-all duration-500 translate-x-8 group-hover:translate-x-0">
                        <span class="text-sm font-bold text-neutral-300 uppercase tracking-wider">View Roster</span>
                        <div class="w-10 h-10 rounded-full border-2 border-white/20 flex items-center justify-center text-white bg-black/20 backdrop-blur-sm group-hover:border-white/80 group-hover:bg-white group-hover:text-black transition-all">
                           <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18l6-6-6-6"/></svg>
                        </div>
                     </div>

                  </div>
                </a>
              );
            })}
          </div>
        </div>
      );
    })}

  </div>
</BaseLayout>