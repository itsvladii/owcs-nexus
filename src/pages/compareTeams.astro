---
import BaseLayout from "../layouts/BaseLayout.astro";
import { fetchAllSeasonMatches } from "../lib/fetchMatches";
import { calculateRankings } from "../lib/calcELO";
import TeamComparison from "../components/TeamComparison"

// 1. Fetch Data
const apiKey = import.meta.env.LIQUIPEDIA_API_KEY;
const userAgent = "OWCS-Nexus (barcanvladi@gmail.com)";
const matches = await fetchAllSeasonMatches(apiKey, userAgent);
const { rankings } = calculateRankings(matches);

// 2. Calculate Rankings
const qualifiedTeams = Object.values(rankings)
    .filter((t: any) => t.wins + t.losses >= 5)
    .filter((t: any) => t.rating >= 1000)
    .map((t: any) => ({
        ...t, // Keep all other props
        // OVERRIDE LOGO: Use Dark Mode if available, else Standard
        logo: t.logoDark || t.logo,
    }))
    .sort((a: any, b: any) => a.name.localeCompare(b.name));
---

<BaseLayout title="Compare Teams" fullWidth={true}>
    <div class="relative w-full h-[60vh] overflow-hidden rounded-xl">
        {/* Replace src with your preferred background */}
        <img
            src="https://live.staticflickr.com/65535/53888709875_7bfb3b8a56_k.jpg"
            alt="OWCS Stage Background"
            class="w-full h-full object-cover object-center scale-105 filter brightness-[0.6]"
        />
        {/* Gradient Overlay */}
        <div
            class="absolute inset-0 bg-gradient-to-b from-neutral-950/30 via-neutral-950/80 to-neutral-950"
        >
        </div>
    </div>

    {/* MAIN CONTENT CONTAINER (Overlapping the banner) */}
    <div class="max-w-6xl mx-auto px-4 relative z-10 -mt-64 md:-mt-80 pb-24">
        <div class="text-center mb-16 drop-shadow-2xl">
            <h1 class="text-6xl md:text-8xl font-title text-white mb-4 tracking-tight">
                Team Comparison
            </h1>
            <p class="text-neutral-300 text-lg md:text-xl max-w-2xl mx-auto font-medium">
                Analyze the ELO history and performance of the best teams in the world.
                <br />
            </p>
        </div>

        {/* Pass the FILTERED list */}
        <TeamComparison teams={qualifiedTeams} matches={matches} client:load />
    </div>
</BaseLayout>
